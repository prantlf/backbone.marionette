!function(i,n){if("function"==typeof define&&define.amd)define(["backbone","underscore","backbone.wreqr","backbone.babysitter"],function(e,t){return i.Marionette=i.Mn=n(i,e,t)});else if("undefined"!=typeof exports){var e=require("backbone"),t=require("underscore");require("backbone.wreqr"),require("backbone.babysitter");module.exports=n(i,e,t)}else i.Marionette=i.Mn=n(i,i.Backbone,i._)}(this,function(e,o,u){"use strict";var t=e.Marionette,i=e.Mn,g=o.Marionette={};g.VERSION="2.4.7-prantlf",g.noConflict=function(){return e.Marionette=t,e.Mn=i,this},g.Deferred=o.$.Deferred,g.FEATURES={},g.isEnabled=function(e){return!!g.FEATURES[e]},g.extend=o.Model.extend,g.isNodeAttached=function(e){return o.$.contains(document.documentElement,e)},g.mergeOptions=function(e,t){e&&u.extend(this,u.pick(e,t))},g.getOption=function(e,t){if(e&&t)return e.options&&void 0!==e.options[t]?e.options[t]:e[t]},g.proxyGetOption=function(e){return g.getOption(this,e)},g._getValue=function(e,t,i){return u.isFunction(e)&&(e=i?e.apply(t,i):e.call(t)),e},g.normalizeMethods=function(e){return u.reduce(e,function(e,t,i){return u.isFunction(t)||(t=this[t]),t&&(e[i]=t),e},{},this)},g.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z-_$0-9]*/g,function(e){return t[e.slice(4)]})},g.normalizeUIKeys=function(e,n){return u.reduce(e,function(e,t,i){return e[g.normalizeUIString(i,n)]=t,e},{})},g.normalizeUIValues=function(t,n,r){return u.each(t,function(i,e){u.isString(i)?t[e]=g.normalizeUIString(i,n):u.isObject(i)&&u.isArray(r)&&(u.extend(i,g.normalizeUIValues(u.pick(i,r),n)),u.each(r,function(e){var t=i[e];u.isString(t)&&(i[e]=g.normalizeUIString(t,n))}))}),t},g.actAsCollection=function(e,i){u.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],function(t){e[t]=function(){var e=[u.values(u.result(this,i))].concat(u.toArray(arguments));return u[t].apply(u,e)}})};var n=g.deprecate=function(e,t){u.isObject(e)&&(e=e.prev+" is going to be removed in the future. Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),void 0!==t&&t||n._cache[e]||(n._warn("Deprecation warning: "+e),n._cache[e]=!0)};n._console="undefined"!=typeof console?console:{},n._warn=function(){return(n._console.warn||n._console.log||function(){}).apply(n._console,arguments)},n._cache={},g._triggerMethod=function(){var o=/(^|:)(\w)/gi;function h(e,t,i){return i.toUpperCase()}return function(e,t,i){var n=arguments.length<3;n&&(t=(i=t)[0]);var r,s=e["on"+t.replace(o,h)];return u.isFunction(s)&&(r=s.apply(e,n?u.rest(i):i)),u.isFunction(e.trigger)&&(1<n+i.length?e.trigger.apply(e,n?i:[t].concat(u.drop(i,0))):e.trigger(t)),r}}(),g.triggerMethod=function(e){return g._triggerMethod(this,arguments)},g.triggerMethodOn=function(e){return(u.isFunction(e.triggerMethod)?e.triggerMethod:g.triggerMethod).apply(e,u.rest(arguments))},g.MonitorDOMRefresh=function(e){function t(){e._isShown&&e._isRendered&&g.isNodeAttached(e.el)&&g.triggerMethodOn(e,"dom:refresh",e)}e._isDomRefreshMonitored||(e._isDomRefreshMonitored=!0,e.on({show:function(){e._isShown=!0,t()},render:function(){e._isRendered=!0,t()}}))},function(o){function n(i,n,r,e){var t=e.split(/\s+/);u.each(t,function(e){var t=i[e];if(!t)throw new o.Error('Method "'+e+'" was configured as an event handler, but does not exist.');i.listenTo(n,r,t)})}function r(e,t,i,n){e.listenTo(t,i,n)}function s(i,n,r,e){var t=e.split(/\s+/);u.each(t,function(e){var t=i[e];i.stopListening(n,r,t)})}function h(e,t,i,n){e.stopListening(t,i,n)}function a(i,n,e,r,s){if(n&&e){if(!u.isObject(e))throw new o.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});e=o._getValue(e,i),u.each(e,function(e,t){u.isFunction(e)?r(i,n,t,e):s(i,n,t,e)})}}o.bindEntityEvents=function(e,t,i){a(e,t,i,r,n)},o.unbindEntityEvents=function(e,t,i){a(e,t,i,h,s)},o.proxyBindEntityEvents=function(e,t){return o.bindEntityEvents(this,e,t)},o.proxyUnbindEntityEvents=function(e,t){return o.unbindEntityEvents(this,e,t)}}(g);var r=["description","fileName","lineNumber","name","message","number"];return g.Error=g.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+g.VERSION+"/",constructor:function(e,t){u.isObject(e)?e=(t=e).message:t||(t={});var i=Error.call(this,e);u.extend(this,u.pick(i,r),u.pick(t,r)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,g.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),g.Error.extend=g.extend,g.Callbacks=function(){this._deferred=g.Deferred(),this._callbacks=[]},u.extend(g.Callbacks.prototype,{add:function(t,i){var e=u.result(this._deferred,"promise");this._callbacks.push({cb:t,ctx:i}),e.then(function(e){i&&(e.context=i),t.call(e.context,e.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=g.Deferred(),this._callbacks=[],u.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),g.Controller=function(e){this.options=e||{},u.isFunction(this.initialize)&&this.initialize(this.options)},g.Controller.extend=g.extend,u.extend(g.Controller.prototype,o.Events,{destroy:function(){return g._triggerMethod(this,"before:destroy",arguments),g._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:g.triggerMethod,mergeOptions:g.mergeOptions,getOption:g.proxyGetOption}),g.Object=function(e){this.options=u.extend({},u.result(this,"options"),e),this.initialize.apply(this,arguments)},g.Object.extend=g.extend,u.extend(g.Object.prototype,o.Events,{initialize:function(){},destroy:function(e){return e=e||{},this.triggerMethod("before:destroy",e),this.triggerMethod("destroy",e),this.stopListening(),this},triggerMethod:g.triggerMethod,mergeOptions:g.mergeOptions,getOption:g.proxyGetOption,bindEntityEvents:g.proxyBindEntityEvents,unbindEntityEvents:g.proxyUnbindEntityEvents}),g.Region=g.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof o.$?this.el[0]:this.el,!this.el)throw new g.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),g.Object.call(this,e)},show:function(e,t){if(this._ensureElement()){this._ensureViewIsIntact(e),g.MonitorDOMRefresh(e);var i=t||{},n=e!==this.currentView,r=!!i.preventDestroy,s=!!i.forceShow,o=!!this.currentView,h=n&&!r,a=n||s;if(o&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&n&&delete this.currentView._parent,h?this.empty():o&&a&&this.currentView.off("destroy",this.empty,this),a){e.once("destroy",this.empty,this),(e._parent=this)._renderView(e),o&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),g.triggerMethodOn(e,"before:show",e,this,t),o&&this.triggerMethod("swapOut",this.currentView,this,t);var d=g.isNodeAttached(this.el),l=[],c=u.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},i);return d&&c.triggerBeforeAttach&&(l=this._displayedViews(e),this._triggerAttach(l,"before:")),this.attachHtml(e),this.currentView=e,d&&c.triggerAttach&&(l=this._displayedViews(e),this._triggerAttach(l)),o&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),g.triggerMethodOn(e,"show",e,this,t),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var i=(t||"")+"attach";u.each(e,function(e){g.triggerMethodOn(e,i,e,this)},this)},_displayedViews:function(e){return u.union([e],u.result(e,"_getNestedViews")||[])},_renderView:function(e){e.supportsRenderLifecycle||g.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||g.triggerMethodOn(e,"render",e)},_ensureElement:function(){if(u.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new g.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new g.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(!0===e.isDestroyed||e._isDestroyed)throw new g.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return o.$(e,g._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(e){var t=this.currentView,i=!!(e||{}).preventDestroy;return t&&(t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),i||this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,i&&this.$el.contents().detach()),this},_destroyView:function(){var e=this.currentView;!0===e.isDestroyed||e._isDestroyed||(e.supportsDestroyLifecycle||g.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():(e.remove(),e.isDestroyed=!0),e.supportsDestroyLifecycle||g.triggerMethodOn(e,"destroy",e))},attachView:function(e){return this.currentView&&delete this.currentView._parent,(e._parent=this).currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(u.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(u.isFunction(e))return this._buildRegionFromRegionClass(e);throw new g.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var i=e.regionClass||t,n=u.omit(e,"selector","regionClass");return e.selector&&!n.el&&(n.el=e.selector),new i(n)},_buildRegionFromRegionClass:function(e){return new e}}),g.RegionManager=g.Controller.extend({constructor:function(e){this._regions={},this.length=0,g.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,n){return e=g._getValue(e,this,arguments),u.reduce(e,function(e,t,i){return u.isString(t)&&(t={selector:t}),t.selector&&(t=u.defaults({},t,n)),e[i]=this.addRegion(i,t),e},{},this)},addRegion:function(e,t){var i;return i=t instanceof g.Region?t:g.Region.buildRegion(t,g.Region),this.triggerMethod("before:add:region",e,i),(i._parent=this)._store(e,i),this.triggerMethod("add:region",e,i),i},get:function(e){return this._regions[e]},getRegions:function(){return u.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return u.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return u.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),g.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]||this.length++,this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this.length--,this.triggerMethod("remove:region",e,t)}}),g.actAsCollection(g.RegionManager.prototype,"_regions"),g.TemplateCache=function(e){this.templateId=e},u.extend(g.TemplateCache,{templateCaches:{},get:function(e,t){var i=this.templateCaches[e];return i||(i=new g.TemplateCache(e),this.templateCaches[e]=i),i.load(t)},clear:function(){var e,t=u.toArray(arguments),i=t.length;if(0<i)for(e=0;e<i;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),u.extend(g.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(e,t){var i=o.$(e);if(!i.length)throw new g.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return i.html()},compileTemplate:function(e,t){return u.template(e,t)}}),g.Renderer={render:function(e,t){if(!e)throw new g.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});return(u.isFunction(e)?e:g.TemplateCache.get(e))(t)}},g.View=o.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(e){this.render=u.bind(this.render,this),e=g._getValue(e,this),this.options=u.extend({},u.result(this,"options"),e),this._constructingMarionetteView=!0,this._behaviors=g.Behaviors(this),o.View.call(this,this.options),delete this._constructingMarionetteView,this._delegateModelAndCollectionEvents(),g.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,u.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=g._getValue(t,this),u.extend(e,t)},normalizeUIKeys:function(e){var t=u.result(this,"_uiBindings");return g.normalizeUIKeys(e,t||u.result(this,"ui"))},normalizeUIValues:function(e,t){var i=u.result(this,"ui"),n=u.result(this,"_uiBindings");return g.normalizeUIValues(e,n||i,t)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(u.result(this,"triggers"));return u.reduce(e,function(e,t,i){return e[i]=this._buildViewTrigger(t),e},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this._constructingMarionetteView||this._delegateModelAndCollectionEvents(),this},_delegateDOMEvents:function(e){var t=g._getValue(e||this.events,this);t=this.normalizeUIKeys(t),u.isUndefined(e)&&(this.events=t);var i={},n=u.result(this,"behaviorEvents")||{},r=this.configureTriggers(),s=u.result(this,"behaviorTriggers")||{};u.extend(i,n,t,r,s),o.View.prototype.delegateEvents.call(this,i)},_delegateModelAndCollectionEvents:function(){this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),u.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this)},undelegateEvents:function(){return o.View.prototype.undelegateEvents.apply(this,arguments),this._constructingMarionetteView||this._undelegateModelAndCollectionEvents(),this},_undelegateModelAndCollectionEvents:function(){this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),u.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this)},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new g.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var e=u.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),u.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),u.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=u.result(this,"_uiBindings");this.ui={},u.each(e,function(e,t){this.ui[t]=this.$(e)},this)}},unbindUIElements:function(){this._unbindUIElements(),u.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(u.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(e){var i=u.defaults({},e,{preventDefault:!0,stopPropagation:!0}),n=u.isObject(e)?i.event:e;return function(e){e&&(e.preventDefault&&i.preventDefault&&e.preventDefault(),e.stopPropagation&&i.stopPropagation&&e.stopPropagation());var t={view:this,model:this.model,collection:this.collection};this.triggerMethod(n,t)}},setElement:function(){var e=o.View.prototype.setElement.apply(this,arguments);return u.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=g._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],u.rest(arguments)),e},_triggerEventOnBehaviors:function(e){for(var t=g._triggerMethod,i=this._behaviors,n=0,r=i&&i.length;n<r;n++)t(i[n],e)},_triggerEventOnParentLayout:function(e,t){var i=this._parentLayoutView();if(i){var n=g.getOption(i,"childViewEventPrefix")+":"+e,r=[this].concat(t);g._triggerMethod(i,n,r);var s=g.getOption(i,"childEvents");s=g._getValue(s,i);var o=i.normalizeMethods(s);o&&u.isFunction(o[e])&&o[e].apply(i,r)}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?u.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},_parentLayoutView:function(){for(var e=this._parent;e;){if(e instanceof g.LayoutView)return e;e=e._parent}},normalizeMethods:g.normalizeMethods,mergeOptions:g.mergeOptions,getOption:g.proxyGetOption,bindEntityEvents:g.proxyBindEntityEvents,unbindEntityEvents:g.proxyUnbindEntityEvents}),g.ItemView=g.View.extend({constructor:function(){g.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,u.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(!1!==e){if(!e)throw new g.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.mixinTemplateHelpers(this.serializeData()),i=g.Renderer.render(e,t,this);return this.attachElContent(i),this}},attachElContent:function(e){return this.$el.html(e),this}}),g.CollectionView=g.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(e){this.once("render",this._initialEvents),this._initChildViewStorage(),g.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var e,t=this._isShown&&g.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),t&&this._triggerBeforeAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),t&&this._triggerAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(e,t,i){var n=u.drop(arguments,3);u.each(e,function(e){g.triggerMethodOn.apply(e,[e,i,e,t].concat(n))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,t,i){var n=void 0!==i.at&&(i.index||t.indexOf(e));if((this.getOption("filter")||!1===n)&&(n=u.indexOf(this._filteredSortedModels(n),e)),this._shouldAddChild(e,n)){this.destroyEmptyView();var r=this.getChildView(e);this.addChild(e,r,n)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){g.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){g.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var n=this.children,e=this._filteredSortedModels();if(!e.length&&this._showingEmptyView)return this;if(u.some(e,function(e){return!n.findByModel(e)}))this.render();else{var t=u.map(e,function(e,t){var i=n.findByModel(e);return i._index=t,i.el}),i=n.filter(function(e){return!u.contains(t,e.el)});this.triggerMethod("before:reorder"),this._appendReorderedChildren(t),u.each(i,this.removeChildView,this),this.checkEmpty(),this.triggerMethod("reorder")}},resortView:function(){g.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var e=this._filteredSortedModels();u.find(e,function(e,t){var i=this.children.findByModel(e);return!i||i._index!==t},this)&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var i,e=this._filteredSortedModels();u.each(e,function(e,t){i=this.getChildView(e),this.addChild(e,i,t)},this)},_filteredSortedModels:function(e){var t,i=this.getViewComparator(),n=this.collection.models;(e=Math.min(Math.max(e,0),n.length-1),i)&&(e&&(t=n[e],n=n.slice(0,e).concat(n.slice(e+1))),n=this._sortModelsBy(n,i),t&&n.splice(e,0,t));return this.getOption("filter")&&(n=u.filter(n,function(e,t){return this._shouldAddChild(e,t)},this)),n},_sortModelsBy:function(e,t){return"string"==typeof t?u.sortBy(e,function(e){return e.get(t)},this):1===t.length?u.sortBy(e,t,this):e.sort(u.bind(t,this))},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var t=new o.Model;this.addEmptyView(t,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var i,n=this._isShown&&!this.isBuffering&&g.isNodeAttached(this.el),r=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");u.isFunction(r)&&(r=r.call(this,e,this._emptyViewIndex));var s=this.buildChildView(e,t,r);(s._parent=this).proxyChildEvents(s),s.once("render",function(){this._isShown&&g.triggerMethodOn(s,"before:show",s),n&&this._triggerBeforeAttach&&(i=this._getViewAndNested(s),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(s),this.renderChildView(s,this._emptyViewIndex),n&&this._triggerAttach&&(i=this._getViewAndNested(s),this._triggerMethodMany(i,this,"attach")),this._isShown&&g.triggerMethodOn(s,"show",s)},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new g.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,i){var n=this.getOption("childViewOptions");n=g._getValue(n,this,[e,i]);var r=this.buildChildView(e,t,n);return this._updateIndices(r,!0,i),this.triggerMethod("before:add:child",r),this._addChildView(r,i),this.triggerMethod("add:child",r),r._parent=this,r},_updateIndices:function(t,i,e){this.getOption("sort")&&(i&&(t._index=e),this.children.each(function(e){e._index>=t._index&&(e._index+=i?1:-1)}))},_addChildView:function(e,t){var i,n=this._isShown&&!this.isBuffering&&g.isNodeAttached(this.el);this.proxyChildEvents(e),e.once("render",function(){this._isShown&&!this.isBuffering&&g.triggerMethodOn(e,"before:show",e),n&&this._triggerBeforeAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(e),this.renderChildView(e,t),n&&this._triggerAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"attach")),this._isShown&&!this.isBuffering&&g.triggerMethodOn(e,"show",e)},renderChildView:function(e,t){return e.supportsRenderLifecycle||g.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||g.triggerMethodOn(e,"render",e),this.attachHtml(this,e,t),e},buildChildView:function(e,t,i){var n=new t(u.extend({model:e},i));return g.MonitorDOMRefresh(n),n},removeChildView:function(e){return e&&(this.triggerMethod("before:remove:child",e),e.supportsDestroyLifecycle||g.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():e.remove(),e.supportsDestroyLifecycle||g.triggerMethodOn(e,"destroy",e),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1)),e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var t=document.createDocumentFragment();return u.each(this._bufferedChildren,function(e){t.appendChild(e.el)}),t},attachHtml:function(e,t,i){e.isBuffering?e._bufferedChildren.splice(i,0,t):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){var i;return this.getOption("sort")&&t<this.children.length-1&&(i=this.children.find(function(e){return e._index===t+1})),!!i&&(i.$el.before(e.el),!0)},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new o.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),g.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(e){var t=e||{},i=!0,n=this.children.map(u.identity);return u.isUndefined(t.checkEmpty)||(i=t.checkEmpty),this.children.each(this.removeChildView,this),i&&this.checkEmpty(),n},_shouldAddChild:function(e,t){var i=this.getOption("filter");return!u.isFunction(i)||i.call(this,e,t,this.collection)},proxyChildEvents:function(n){var r=this.getOption("childViewEventPrefix");this.listenTo(n,"all",function(){var e=u.toArray(arguments),t=e[0],i=this.normalizeMethods(u.result(this,"childEvents"));e[0]=r+":"+t,e.splice(1,0,n),void 0!==i&&u.isFunction(i[t])&&i[t].apply(this,e.slice(1)),this.triggerMethod.apply(this,e)})},_getImmediateChildren:function(){return u.values(this.children._views)},_getViewAndNested:function(e){return[e].concat(u.result(e,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),g.CompositeView=g.CollectionView.extend({constructor:function(){g.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){return this.getOption("childView")||this.constructor},serializeData:function(){var e={};return this.model&&(e=u.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&g.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),i=g.Renderer.render(t,e,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){this.getChildViewContainer(e).append(t)},_insertAfter:function(e){this.getChildViewContainer(this,e).append(e.el)},_appendReorderedChildren:function(e){this.getChildViewContainer(this).append(e)},getChildViewContainer:function(e,t){if(e.$childViewContainer)return e.$childViewContainer;var i,n=g.getOption(e,"childViewContainer");if(n){var r=g._getValue(n,e);if((i="@"===r.charAt(0)&&e.ui?e.ui[r.substr(4)]:e.$(r)).length<=0)throw new g.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else i=e.$el;return e.$childViewContainer=i},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),g.LayoutView=g.ItemView.extend({regionClass:g.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),g.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),g.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(!0===this.getOption("destroyImmediate")&&this.$el.remove(),this.regionManager.destroy(),g.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(e,t,i){var n=this.getRegion(e);return n.show.apply(n,u.rest(arguments))},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=u.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:u.partial(u.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=g._getValue(this.regions,this,[e])||{};var i=this.getOption.call(e,"regions");i=g._getValue(i,this,[e]),u.extend(t,i),t=this.normalizeUIValues(t,["selector","el"]),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new g.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),(this.regionManager._parent=this).listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return u.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),g.Behavior=g.Object.extend({constructor:function(e,t){this.view=t,this.defaults=u.result(this,"defaults")||{},this.options=u.extend({},this.defaults,e),this.ui=u.extend({},u.result(t,"ui"),u.result(this,"ui")),g.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){e||(e=this.view),this.$el=e.$el,this.el=e.el}}),g.Behaviors=function(n,d){var r,l=/^(\S+)\s*(.*)$/;function s(e,t){return d.isObject(e.behaviors)?(t=s.parseBehaviors(e,t||d.result(e,"behaviors")),s.wrap(e,t,d.keys(r)),t):{}}function i(e,t){this._view=e,this._behaviors=t,this._triggers={}}function c(e){return e._uiBindings||e.ui}return r={behaviorTriggers:function(e,t){return new i(this,t).buildBehaviorTriggers()},behaviorEvents:function(e,t){var i={};return d.each(t,function(s,o){var h={},e=d.clone(d.result(s,"events"))||{};e=n.normalizeUIKeys(e,c(s));var a=0;d.each(e,function(e,t){var i=t.match(l),n=i[1]+"."+[this.cid,o,a++," "].join("")+i[2],r=d.isFunction(e)?e:s[e];r&&(h[n]=d.bind(r,s))},this),i=d.extend(i,h)},this),i}},d.extend(s,{behaviorsLookup:function(){throw new n.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(e,t){return e.behaviorClass?e.behaviorClass:n._getValue(s.behaviorsLookup,this,[e,t])[t]},parseBehaviors:function(r,e){return d.chain(e).map(function(e,t){var i=new(s.getBehaviorClass(e,t))(e,r),n=s.parseBehaviors(r,d.result(i,"behaviors"));return[i].concat(n)}).flatten().value()},wrap:function(t,i,e){d.each(e,function(e){t[e]=d.partial(r[e],t[e],i)})}}),d.extend(i.prototype,{buildBehaviorTriggers:function(){return d.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(e,t){var i=d.clone(d.result(e,"triggers"))||{};i=n.normalizeUIKeys(i,c(e)),d.each(i,d.bind(this._setHandlerForBehavior,this,e,t))},_setHandlerForBehavior:function(e,t,i,n){var r=n.replace(/^\S+/,function(e){return e+".behaviortriggers"+t});this._triggers[r]=this._view._buildViewTrigger(i)}}),s}(g,u),g.AppRouter=o.Router.extend({constructor:function(e){this.options=e||{},o.Router.apply(this,arguments);var t=this.getOption("appRoutes"),i=this._getController();this.processAppRoutes(i,t),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){if(u.isFunction(this.onRoute)){var i=u.invert(this.getOption("appRoutes"))[e];this.onRoute(e,i,t)}},processAppRoutes:function(t,i){if(i){var e=u.keys(i).reverse();u.each(e,function(e){this._addAppRoute(t,e,i[e])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,i){var n=e[i];if(!n)throw new g.Error('Method "'+i+'" was not found on the controller');this.route(t,i,u.bind(n,e))},mergeOptions:g.mergeOptions,getOption:g.proxyGetOption,triggerMethod:g.triggerMethod,bindEntityEvents:g.proxyBindEntityEvents,unbindEntityEvents:g.proxyUnbindEntityEvents}),g.Application=g.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new g.Callbacks,this.submodules={},u.extend(this,e),this._initChannel(),g.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var i=g.Module.getClass(t),n=u.toArray(arguments);return n.unshift(this),i.create.apply(i,n)},getRegionManager:function(){return new g.RegionManager},_initializeRegions:function(e){var t=u.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var i=g.getOption(e,"regions");return u.isFunction(i)&&(i=i.call(this,e)),u.extend(t,i),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),(this._regionManager._parent=this).listenTo(this._regionManager,"before:add:region",function(){g._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,g._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){g._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],g._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=u.result(this,"channelName")||"global",this.channel=u.result(this,"channel")||o.Wreqr.radio.channel(this.channelName),this.vent=u.result(this,"vent")||this.channel.vent,this.commands=u.result(this,"commands")||this.channel.commands,this.reqres=u.result(this,"reqres")||this.channel.reqres}}),g.Module=function(e,t,i){this.moduleName=e,this.options=u.extend({},this.options,i),this.initialize=i.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,u.isFunction(this.initialize)&&this.initialize(e,t,this.options)},g.Module.extend=g.extend,u.extend(g.Module.prototype,o.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(t){this._isInitialized||(u.each(this.submodules,function(e){e.startWithParent&&e.start(t)}),this.triggerMethod("before:start",t),this._initializerCallbacks.run(t,this),this._isInitialized=!0,this.triggerMethod("start",t))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),u.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,t){if(e){var i=u.flatten([this,this.app,o,g,o.$,u,t]);e.apply(this,i)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new g.Callbacks,this._finalizerCallbacks=new g.Callbacks},triggerMethod:g.triggerMethod}),u.extend(g.Module,{create:function(n,e,r){var s=n,o=u.drop(arguments,3),t=(e=e.split(".")).length,h=[];return h[t-1]=r,u.each(e,function(e,t){var i=s;s=this._getModule(i,e,n,r),this._addModuleDefinition(i,s,h[t],o)},this),s},_getModule:function(e,t,i,n,r){var s=u.extend({},n),o=this.getClass(n),h=e[t];return h||(h=new o(t,i,s),e[t]=h,e.submodules[t]=h),h},getClass:function(e){var t=g.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var r=this._getDefine(i),s=this._getStartWithParent(i,t);r&&t.addDefinition(r,n),this._addStartWithParent(e,t,s)},_getStartWithParent:function(e,t){var i;return u.isFunction(e)&&e.prototype instanceof g.Module?(i=t.constructor.prototype.startWithParent,!!u.isUndefined(i)||i):!u.isObject(e)||(i=e.startWithParent,!!u.isUndefined(i)||i)},_getDefine:function(e){return!u.isFunction(e)||e.prototype instanceof g.Module?u.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),g});
//# sourceMappingURL=backbone.marionette.min.js.map